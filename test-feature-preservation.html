<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Feature Preservation Tests - Responsive Settings Menu</title>
  <link rel="stylesheet" href="css/style.css" />
  <link rel="stylesheet" href="css/responsive-settings-menu.css" />
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      padding: 20px;
      max-width: 1200px;
      margin: 0 auto;
      background: #f5f5f5;
    }
    
    .test-header {
      background: white;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .test-header h1 {
      margin: 0 0 10px 0;
      color: #333;
    }
    
    .test-header p {
      margin: 5px 0;
      color: #666;
    }
    
    .test-results {
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .test-suite {
      margin-bottom: 20px;
      border-left: 3px solid #4f46e5;
      padding-left: 15px;
    }
    
    .test-suite h3 {
      margin: 0 0 10px 0;
      color: #4f46e5;
    }
    
    .test-case {
      padding: 10px;
      margin: 5px 0;
      border-radius: 4px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .test-case.pass {
      background: #d1fae5;
      border-left: 3px solid #10b981;
    }
    
    .test-case.fail {
      background: #fee2e2;
      border-left: 3px solid #ef4444;
    }
    
    .test-case .icon {
      font-size: 20px;
    }
    
    .test-case .message {
      flex: 1;
      font-size: 14px;
    }
    
    .test-summary {
      background: #f9fafb;
      padding: 15px;
      border-radius: 4px;
      margin-top: 20px;
      display: flex;
      justify-content: space-around;
      text-align: center;
    }
    
    .test-summary .stat {
      flex: 1;
    }
    
    .test-summary .stat .value {
      font-size: 32px;
      font-weight: bold;
      margin-bottom: 5px;
    }
    
    .test-summary .stat .label {
      font-size: 14px;
      color: #666;
      text-transform: uppercase;
    }
    
    .test-summary .stat.total .value { color: #4f46e5; }
    .test-summary .stat.passed .value { color: #10b981; }
    .test-summary .stat.failed .value { color: #ef4444; }
    
    .run-button {
      background: #4f46e5;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 6px;
      font-size: 16px;
      cursor: pointer;
      margin-bottom: 20px;
    }
    
    .run-button:hover {
      background: #4338ca;
    }
    
    .run-button:disabled {
      background: #9ca3af;
      cursor: not-allowed;
    }
    
    .visually-hidden {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border-width: 0;
    }
  </style>
</head>
<body>
  <div class="test-header">
    <h1>ğŸ§ª Feature Preservation Tests</h1>
    <p><strong>Feature:</strong> responsive-settings-menu</p>
    <p><strong>Task:</strong> 7.8 Write unit tests for feature preservation</p>
    <p><strong>Validates:</strong> Requirements 2.3, 3.1, 3.2, 3.3, 3.4, 3.5, 3.6, 3.7</p>
  </div>

  <button id="runTests" class="run-button">â–¶ Run Tests</button>

  <div class="test-results" id="testResults">
    <p style="color: #666;">Click "Run Tests" to start testing...</p>
  </div>

  <!-- Settings Menu Toggle Button -->
  <button 
    id="settingsMenuToggle" 
    class="settings-menu-toggle"
    aria-label="Open settings menu"
    aria-expanded="false"
    aria-controls="settingsMenuPanel"
    aria-haspopup="true"
    type="button">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
      <circle cx="12" cy="5" r="2" fill="currentColor"/>
      <circle cx="12" cy="12" r="2" fill="currentColor"/>
      <circle cx="12" cy="19" r="2" fill="currentColor"/>
    </svg>
    <span class="visually-hidden">Settings Menu</span>
  </button>

  <!-- Settings Menu Backdrop -->
  <div 
    id="settingsMenuBackdrop" 
    class="settings-menu-backdrop"
    aria-hidden="true"
    role="presentation"></div>

  <!-- Settings Menu Panel -->
  <aside 
    id="settingsMenuPanel" 
    class="settings-menu-panel"
    role="dialog"
    aria-modal="true"
    aria-labelledby="settingsMenuTitle"
    aria-hidden="true">
    <div class="settings-menu-header">
      <h2 id="settingsMenuTitle" class="settings-menu-title">
        <span class="icon" aria-hidden="true">âš™ï¸</span>
        <span>Settings</span>
      </h2>
      <button 
        id="settingsMenuClose" 
        class="settings-menu-close"
        aria-label="Close settings menu"
        type="button">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
          <path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
        <span class="visually-hidden">Close</span>
      </button>
    </div>
    
    <div class="settings-menu-content" role="group" aria-label="Settings controls">
      <!-- Theme Toggle -->
      <div class="menu-control-group">
        <button onclick="toggleTheme()" class="extra-btn menu-control-btn" id="btnTheme">
          ğŸŒ™ <span id="btnThemeText">Dark Mode</span>
        </button>
      </div>

      <!-- Language Selector -->
      <div class="menu-control-group">
        <label for="languageSelect" class="menu-control-label">
          <span class="icon">ğŸŒ</span>
          <span id="lblLanguage">Language</span>
        </label>
        <select id="languageSelect" class="menu-control-select" onchange="setLanguage(this.value)">
          <option value="en">ğŸ‡¬ğŸ‡§ English</option>
          <option value="tr">ğŸ‡¹ğŸ‡· TÃ¼rkÃ§e</option>
          <option value="es">ğŸ‡ªğŸ‡¸ EspaÃ±ol</option>
          <option value="fr">ğŸ‡«ğŸ‡· FranÃ§ais</option>
          <option value="de">ğŸ‡©ğŸ‡ª Deutsch</option>
          <option value="it">ğŸ‡®ğŸ‡¹ Italiano</option>
          <option value="ru">ğŸ‡·ğŸ‡º Ğ ÑƒÑÑĞºĞ¸Ğ¹</option>
          <option value="zh">ğŸ‡¨ğŸ‡³ ä¸­æ–‡</option>
          <option value="ja">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</option>
          <option value="pt">ğŸ‡µğŸ‡¹ PortuguÃªs</option>
          <option value="ar">ğŸ‡¸ğŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
        </select>
      </div>

      <!-- Piece Setup -->
      <div class="menu-control-group">
        <button onclick="openPieceSetup()" class="extra-btn menu-control-btn" id="btnPieceSetup">
          â™” <span id="btnPieceSetupText">Piece Setup</span>
        </button>
      </div>

      <!-- Position Analysis -->
      <div class="menu-control-group">
        <button onclick="analyzeCurrentPosition()" class="extra-btn menu-control-btn" id="btnAnalyzePosition">
          ğŸ” <span id="btnAnalyzePositionText">Analyze Position</span>
        </button>
      </div>

      <!-- Position Sharing -->
      <div class="menu-control-group">
        <button onclick="shareCurrentPosition()" class="extra-btn menu-control-btn" id="btnSharePosition">
          ğŸ”— <span id="btnSharePositionText">Share Position</span>
        </button>
      </div>
    </div>
  </aside>

  <!-- Game Container (for backend/move history tests) -->
  <div id="mainGameContainer" style="display: none;">
    <div id="moveHistory"></div>
  </div>

  <!-- Mock functions for testing -->
  <script>
    // Mock functions that would normally be in game.js
    function toggleTheme() {
      console.log('toggleTheme called');
    }
    
    function setLanguage(lang) {
      console.log('setLanguage called with:', lang);
    }
    
    function openPieceSetup() {
      console.log('openPieceSetup called');
    }
    
    function analyzeCurrentPosition() {
      console.log('analyzeCurrentPosition called');
    }
    
    function shareCurrentPosition() {
      console.log('shareCurrentPosition called');
    }
  </script>

  <!-- Simple test framework -->
  <script>
    // Simple test framework
    const testResults = {
      suites: [],
      total: 0,
      passed: 0,
      failed: 0
    };

    let currentSuite = null;

    function describe(name, fn) {
      currentSuite = {
        name: name,
        tests: []
      };
      testResults.suites.push(currentSuite);
      fn();
      currentSuite = null;
    }

    function test(name, fn) {
      testResults.total++;
      try {
        fn();
        testResults.passed++;
        currentSuite.tests.push({
          name: name,
          passed: true
        });
      } catch (error) {
        testResults.failed++;
        currentSuite.tests.push({
          name: name,
          passed: false,
          error: error.message
        });
      }
    }

    function expect(value) {
      return {
        toBe(expected) {
          if (value !== expected) {
            throw new Error(`Expected ${expected} but got ${value}`);
          }
        },
        toBeTruthy() {
          if (!value) {
            throw new Error(`Expected truthy value but got ${value}`);
          }
        },
        toBeGreaterThan(expected) {
          if (value <= expected) {
            throw new Error(`Expected ${value} to be greater than ${expected}`);
          }
        },
        toBeGreaterThanOrEqual(expected) {
          if (value < expected) {
            throw new Error(`Expected ${value} to be greater than or equal to ${expected}`);
          }
        },
        toContain(expected) {
          if (Array.isArray(value)) {
            if (!value.includes(expected)) {
              throw new Error(`Expected array to contain ${expected}`);
            }
          } else if (typeof value === 'string') {
            if (!value.includes(expected)) {
              throw new Error(`Expected "${value}" to contain "${expected}"`);
            }
          } else {
            throw new Error(`toContain requires array or string`);
          }
        },
        not: {
          toBe(expected) {
            if (value === expected) {
              throw new Error(`Expected ${value} not to be ${expected}`);
            }
          },
          toBeNull() {
            if (value === null) {
              throw new Error(`Expected value not to be null`);
            }
          }
        },
        toMatch(regex) {
          if (!regex.test(value)) {
            throw new Error(`Expected "${value}" to match ${regex}`);
          }
        }
      };
    }

    function renderResults() {
      const resultsDiv = document.getElementById('testResults');
      
      let html = '';
      
      // Render each suite
      testResults.suites.forEach(suite => {
        html += `<div class="test-suite">`;
        html += `<h3>${suite.name}</h3>`;
        
        suite.tests.forEach(test => {
          const className = test.passed ? 'pass' : 'fail';
          const icon = test.passed ? 'âœ…' : 'âŒ';
          html += `<div class="test-case ${className}">`;
          html += `<span class="icon">${icon}</span>`;
          html += `<span class="message">${test.name}</span>`;
          if (!test.passed) {
            html += `<br><small style="color: #ef4444; margin-left: 30px;">${test.error}</small>`;
          }
          html += `</div>`;
        });
        
        html += `</div>`;
      });
      
      // Render summary
      html += `<div class="test-summary">`;
      html += `<div class="stat total">`;
      html += `<div class="value">${testResults.total}</div>`;
      html += `<div class="label">Total</div>`;
      html += `</div>`;
      html += `<div class="stat passed">`;
      html += `<div class="value">${testResults.passed}</div>`;
      html += `<div class="label">Passed</div>`;
      html += `</div>`;
      html += `<div class="stat failed">`;
      html += `<div class="value">${testResults.failed}</div>`;
      html += `<div class="label">Failed</div>`;
      html += `</div>`;
      html += `</div>`;
      
      resultsDiv.innerHTML = html;
    }

    // Run tests button
    document.getElementById('runTests').addEventListener('click', function() {
      this.disabled = true;
      this.textContent = 'â³ Running tests...';
      
      // Reset results
      testResults.suites = [];
      testResults.total = 0;
      testResults.passed = 0;
      testResults.failed = 0;
      
      // Load and run tests
      const script = document.createElement('script');
      script.src = 'test/responsive-settings-menu-feature-preservation.test.js';
      script.onload = () => {
        setTimeout(() => {
          renderResults();
          this.disabled = false;
          this.textContent = 'ğŸ”„ Run Tests Again';
        }, 100);
      };
      script.onerror = () => {
        document.getElementById('testResults').innerHTML = 
          '<p style="color: #ef4444;">âŒ Error loading test file. Make sure test/responsive-settings-menu-feature-preservation.test.js exists.</p>';
        this.disabled = false;
        this.textContent = 'ğŸ”„ Try Again';
      };
      document.head.appendChild(script);
    });
  </script>
</body>
</html>
