<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test Responsive Menu Initialization</title>
  <link rel="stylesheet" href="css/responsive-settings-menu.css">
  <style>
    body {
      margin: 0;
      padding: 20px;
      font-family: Arial, sans-serif;
    }
    
    .test-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    
    .test-section {
      margin: 20px 0;
      padding: 20px;
      border: 1px solid #ddd;
      border-radius: 8px;
      background: #f9f9f9;
    }
    
    .test-section h2 {
      margin-top: 0;
      color: #333;
    }
    
    .status-indicator {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 4px;
      font-weight: bold;
      margin-left: 10px;
    }
    
    .status-success {
      background: #4caf50;
      color: white;
    }
    
    .status-error {
      background: #f44336;
      color: white;
    }
    
    .test-button {
      padding: 10px 20px;
      margin: 5px;
      border: none;
      border-radius: 4px;
      background: #2196f3;
      color: white;
      cursor: pointer;
      font-size: 14px;
    }
    
    .test-button:hover {
      background: #1976d2;
    }
    
    .info-box {
      padding: 10px;
      margin: 10px 0;
      background: #e3f2fd;
      border-left: 4px solid #2196f3;
      border-radius: 4px;
    }
    
    .log-output {
      background: #263238;
      color: #aed581;
      padding: 15px;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      max-height: 300px;
      overflow-y: auto;
      margin-top: 10px;
    }
    
    .log-entry {
      margin: 2px 0;
    }
  </style>
</head>
<body>
  <!-- Settings Menu Toggle Button -->
  <button 
    id="settingsMenuToggle" 
    class="settings-menu-toggle"
    aria-label="Open settings menu"
    aria-expanded="false"
    aria-controls="settingsMenuPanel"
    aria-haspopup="true"
    type="button">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
      <circle cx="12" cy="5" r="2" fill="currentColor"/>
      <circle cx="12" cy="12" r="2" fill="currentColor"/>
      <circle cx="12" cy="19" r="2" fill="currentColor"/>
    </svg>
    <span class="visually-hidden">Settings Menu</span>
  </button>

  <!-- Settings Menu Backdrop -->
  <div 
    id="settingsMenuBackdrop" 
    class="settings-menu-backdrop"
    aria-hidden="true"
    role="presentation"></div>

  <!-- Settings Menu Panel -->
  <aside 
    id="settingsMenuPanel" 
    class="settings-menu-panel"
    role="dialog"
    aria-modal="true"
    aria-labelledby="settingsMenuTitle"
    aria-hidden="true">
    <div class="settings-menu-header">
      <h2 id="settingsMenuTitle" class="settings-menu-title">
        <span class="icon" aria-hidden="true">‚öôÔ∏è</span>
        <span>Settings</span>
      </h2>
      <button 
        id="settingsMenuClose" 
        class="settings-menu-close"
        aria-label="Close settings menu"
        type="button">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
          <path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
        <span class="visually-hidden">Close</span>
      </button>
    </div>
    
    <div class="settings-menu-content" role="group" aria-label="Settings controls">
      <div style="padding: 20px;">
        <h3>Test Menu Content</h3>
        <p>This is a test of the settings menu system.</p>
        <button class="test-button">Test Button 1</button>
        <button class="test-button">Test Button 2</button>
        <button class="test-button">Test Button 3</button>
      </div>
    </div>
  </aside>

  <div class="test-container">
    <h1>Responsive Settings Menu Initialization Test</h1>
    
    <div class="test-section">
      <h2>Initialization Status</h2>
      <div id="initStatus">
        <p>ResponsiveLayoutManager: <span id="layoutManagerStatus">Not initialized</span></p>
        <p>SettingsMenuManager: <span id="menuManagerStatus">Not initialized</span></p>
      </div>
    </div>
    
    <div class="test-section">
      <h2>Current State</h2>
      <div class="info-box">
        <p><strong>Breakpoint:</strong> <span id="currentBreakpoint">-</span></p>
        <p><strong>Viewport:</strong> <span id="viewportSize">-</span></p>
        <p><strong>Board Size:</strong> <span id="boardSize">-</span></p>
        <p><strong>Menu Open:</strong> <span id="menuOpen">-</span></p>
      </div>
    </div>
    
    <div class="test-section">
      <h2>Test Controls</h2>
      <button class="test-button" onclick="testToggleMenu()">Toggle Menu</button>
      <button class="test-button" onclick="testOpenMenu()">Open Menu</button>
      <button class="test-button" onclick="testCloseMenu()">Close Menu</button>
      <button class="test-button" onclick="testRecalculateLayout()">Recalculate Layout</button>
      <button class="test-button" onclick="testGetState()">Get State</button>
      <button class="test-button" onclick="clearLog()">Clear Log</button>
    </div>
    
    <div class="test-section">
      <h2>Event Log</h2>
      <div id="logOutput" class="log-output">
        <div class="log-entry">Waiting for initialization...</div>
      </div>
    </div>
  </div>

  <script src="js/responsive-layout-manager.js"></script>
  <script src="js/settings-menu-manager.js"></script>
  
  <script>
    // Log output helper
    function log(message, type = 'info') {
      const logOutput = document.getElementById('logOutput');
      const timestamp = new Date().toLocaleTimeString();
      const entry = document.createElement('div');
      entry.className = 'log-entry';
      entry.textContent = `[${timestamp}] ${message}`;
      logOutput.appendChild(entry);
      logOutput.scrollTop = logOutput.scrollHeight;
      console.log(message);
    }
    
    function clearLog() {
      document.getElementById('logOutput').innerHTML = '';
      log('Log cleared');
    }
    
    function updateStatus() {
      if (window.responsiveLayoutManager) {
        const breakpoint = window.responsiveLayoutManager.getCurrentBreakpoint();
        const boardSize = window.responsiveLayoutManager.calculateBoardSize();
        
        document.getElementById('currentBreakpoint').textContent = breakpoint;
        document.getElementById('viewportSize').textContent = 
          `${window.innerWidth} x ${window.innerHeight}`;
        document.getElementById('boardSize').textContent = 
          `${boardSize.width} x ${boardSize.height}`;
      }
      
      if (window.settingsMenuManager) {
        document.getElementById('menuOpen').textContent = 
          window.settingsMenuManager.isOpen() ? 'Yes' : 'No';
      }
    }
    
    // Test functions
    function testToggleMenu() {
      log('Testing menu toggle...');
      window.settingsMenuManager.toggle();
      setTimeout(updateStatus, 350);
    }
    
    function testOpenMenu() {
      log('Testing menu open...');
      window.settingsMenuManager.open();
      setTimeout(updateStatus, 350);
    }
    
    function testCloseMenu() {
      log('Testing menu close...');
      window.settingsMenuManager.close();
      setTimeout(updateStatus, 350);
    }
    
    function testRecalculateLayout() {
      log('Testing layout recalculation...');
      window.responsiveLayoutManager.recalculateLayout();
      setTimeout(updateStatus, 100);
    }
    
    function testGetState() {
      const layoutState = window.responsiveLayoutManager.getResponsiveState();
      log('Layout State: ' + JSON.stringify(layoutState, null, 2));
      log('Menu Open: ' + window.settingsMenuManager.isOpen());
    }
    
    // Initialize on page load
    document.addEventListener('DOMContentLoaded', function() {
      log('üöÄ Starting initialization...');
      
      try {
        // Create ResponsiveLayoutManager instance
        window.responsiveLayoutManager = new ResponsiveLayoutManager();
        log('‚úÖ ResponsiveLayoutManager created');
        document.getElementById('layoutManagerStatus').innerHTML = 
          '<span class="status-indicator status-success">Initialized</span>';
        
        // Create SettingsMenuManager instance
        window.settingsMenuManager = new SettingsMenuManager({
          toggleButtonSelector: '#settingsMenuToggle',
          backdropSelector: '#settingsMenuBackdrop',
          panelSelector: '#settingsMenuPanel',
          closeButtonSelector: '#settingsMenuClose',
          contentSelector: '.settings-menu-content',
          animationDuration: 300
        });
        log('‚úÖ SettingsMenuManager created');
        
        // Initialize settings menu
        const menuInitialized = window.settingsMenuManager.initialize();
        
        if (menuInitialized) {
          log('‚úÖ Settings Menu Manager initialized successfully');
          document.getElementById('menuManagerStatus').innerHTML = 
            '<span class="status-indicator status-success">Initialized</span>';
        } else {
          log('‚ùå Failed to initialize Settings Menu Manager');
          document.getElementById('menuManagerStatus').innerHTML = 
            '<span class="status-indicator status-error">Failed</span>';
        }
        
        // Wire up event listeners
        window.responsiveLayoutManager.onBreakpointChange((current, previous) => {
          log(`üì± Breakpoint changed: ${previous} ‚Üí ${current}`);
          updateStatus();
        });
        
        // Apply initial layout
        const initialBreakpoint = window.responsiveLayoutManager.getCurrentBreakpoint();
        const boardSize = window.responsiveLayoutManager.calculateBoardSize();
        
        log(`üìä Initial state: ${initialBreakpoint}, Board: ${boardSize.width}x${boardSize.height}`);
        
        // Listen for custom events
        document.addEventListener('responsive-layout-breakpointchange', (event) => {
          log('üì± Layout event: breakpointchange');
        });
        
        document.addEventListener('responsive-layout-resize', (event) => {
          log('üìê Layout event: resize');
          updateStatus();
        });
        
        document.addEventListener('responsive-layout-orientationchange', (event) => {
          log('üîÑ Layout event: orientationchange');
        });
        
        log('‚ú® Initialization complete!');
        updateStatus();
        
      } catch (error) {
        log('‚ùå Error during initialization: ' + error.message);
        console.error(error);
      }
    });
    
    // Update status on window resize
    window.addEventListener('resize', () => {
      setTimeout(updateStatus, 150);
    });
  </script>
</body>
</html>
