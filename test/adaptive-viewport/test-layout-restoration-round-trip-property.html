<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Property Test: Layout Restoration Round-Trip</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      background: #f5f5f5;
    }
    
    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 30px;
      border-radius: 10px;
      margin-bottom: 30px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    
    .header h1 {
      margin: 0 0 10px 0;
      font-size: 28px;
    }
    
    .header p {
      margin: 5px 0;
      opacity: 0.9;
      font-size: 14px;
    }
    
    .test-container {
      background: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }
    
    .controls {
      display: flex;
      gap: 15px;
      margin-bottom: 25px;
      flex-wrap: wrap;
    }
    
    button {
      padding: 12px 24px;
      font-size: 16px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 500;
    }
    
    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    
    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }
    
    .btn-secondary {
      background: #6c757d;
      color: white;
    }
    
    .status {
      padding: 15px;
      border-radius: 6px;
      margin-bottom: 20px;
      font-weight: 500;
    }
    
    .status.running {
      background: #fff3cd;
      color: #856404;
      border-left: 4px solid #ffc107;
    }
    
    .status.success {
      background: #d4edda;
      color: #155724;
      border-left: 4px solid #28a745;
    }
    
    .status.error {
      background: #f8d7da;
      color: #721c24;
      border-left: 4px solid #dc3545;
    }
    
    .status.info {
      background: #d1ecf1;
      color: #0c5460;
      border-left: 4px solid #17a2b8;
    }
    
    #output {
      background: #1e1e1e;
      color: #d4d4d4;
      padding: 20px;
      border-radius: 6px;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      line-height: 1.6;
      max-height: 600px;
      overflow-y: auto;
      white-space: pre-wrap;
      word-wrap: break-word;
    }
    
    .summary {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }
    
    .summary-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 20px;
      border-radius: 8px;
      text-align: center;
    }
    
    .summary-card h3 {
      margin: 0 0 10px 0;
      font-size: 14px;
      opacity: 0.9;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    
    .summary-card .value {
      font-size: 32px;
      font-weight: bold;
      margin: 0;
    }
    
    .test-info {
      background: #e7f3ff;
      border-left: 4px solid #2196F3;
      padding: 15px;
      border-radius: 6px;
      margin-bottom: 20px;
    }
    
    .test-info h3 {
      margin: 0 0 10px 0;
      color: #1976D2;
    }
    
    .test-info ul {
      margin: 10px 0;
      padding-left: 20px;
    }
    
    .test-info li {
      margin: 5px 0;
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>üîÑ Property Test: Layout Restoration Round-Trip</h1>
    <p><strong>Feature:</strong> adaptive-viewport-optimizer</p>
    <p><strong>Property 7:</strong> Layout Restoration Round-Trip</p>
    <p><strong>Validates:</strong> Requirements 2.5</p>
  </div>

  <div class="test-container">
    <div class="test-info">
      <h3>Test Description</h3>
      <p>
        This property test verifies that for any viewport configuration, if the viewport 
        is shrunk to trigger vertical repositioning and then expanded back to the original 
        size, elements should return to their original horizontal positions.
      </p>
      <p><strong>Test Properties:</strong></p>
      <ul>
        <li>Property 1: Single element returns to original position after round-trip</li>
        <li>Property 2: Multiple elements return to original positions after round-trip</li>
        <li>Property 3: Layout strategy returns to original after round-trip</li>
        <li>Property 4: Board position returns to original after round-trip</li>
        <li>Property 5: Multiple round-trips maintain position consistency</li>
      </ul>
      <p><strong>Iterations:</strong> 100 per property (500 total)</p>
    </div>

    <div class="controls">
      <button id="runTests" class="btn-primary">‚ñ∂ Run Property Tests</button>
      <button id="clearOutput" class="btn-secondary">üóë Clear Output</button>
    </div>

    <div id="status" class="status info">
      Ready to run tests. Click "Run Property Tests" to begin.
    </div>

    <div id="output"></div>

    <div id="summaryContainer" style="display: none;">
      <div class="summary">
        <div class="summary-card">
          <h3>Properties Tested</h3>
          <p class="value" id="totalTests">0</p>
        </div>
        <div class="summary-card">
          <h3>Passed</h3>
          <p class="value" id="passedTests">0</p>
        </div>
        <div class="summary-card">
          <h3>Failed</h3>
          <p class="value" id="failedTests">0</p>
        </div>
        <div class="summary-card">
          <h3>Success Rate</h3>
          <p class="value" id="successRate">0%</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Load fast-check library -->
  <script src="../adaptive-viewport/setup-fast-check.js"></script>

  <!-- Load dependencies -->
  <script src="../../js/adaptive-viewport/constants.js"></script>
  <script src="../../js/adaptive-viewport/types.js"></script>
  <script src="../../js/adaptive-viewport/error-handler.js"></script>
  <script src="../../js/adaptive-viewport/base-component.js"></script>
  <script src="../../js/adaptive-viewport/visibility-detector.js"></script>
  <script src="../../js/adaptive-viewport/layout-optimizer.js"></script>

  <!-- Load test file -->
  <script src="layout-restoration-round-trip-property.test.js"></script>

  <script>
    const outputDiv = document.getElementById('output');
    const statusDiv = document.getElementById('status');
    const runButton = document.getElementById('runTests');
    const clearButton = document.getElementById('clearOutput');
    const summaryContainer = document.getElementById('summaryContainer');

    // Override console.log to capture output
    const originalLog = console.log;
    const originalError = console.error;
    const originalWarn = console.warn;

    function appendOutput(message, type = 'log') {
      const span = document.createElement('span');
      
      if (type === 'error') {
        span.style.color = '#f48771';
      } else if (type === 'warn') {
        span.style.color = '#dcdcaa';
      } else if (message.includes('‚úì')) {
        span.style.color = '#4ec9b0';
      } else if (message.includes('‚úó')) {
        span.style.color = '#f48771';
      } else if (message.includes('===')) {
        span.style.color = '#569cd6';
        span.style.fontWeight = 'bold';
      }
      
      span.textContent = message + '\n';
      outputDiv.appendChild(span);
      outputDiv.scrollTop = outputDiv.scrollHeight;
    }

    console.log = function(...args) {
      originalLog.apply(console, args);
      appendOutput(args.join(' '), 'log');
    };

    console.error = function(...args) {
      originalError.apply(console, args);
      appendOutput(args.join(' '), 'error');
    };

    console.warn = function(...args) {
      originalWarn.apply(console, args);
      appendOutput(args.join(' '), 'warn');
    };

    async function runTests() {
      runButton.disabled = true;
      outputDiv.innerHTML = '';
      summaryContainer.style.display = 'none';
      
      statusDiv.className = 'status running';
      statusDiv.textContent = '‚è≥ Running property tests... This may take a minute.';

      try {
        // Wait for fast-check to be available
        if (typeof fc === 'undefined') {
          throw new Error('fast-check library not loaded');
        }

        console.log('Starting Layout Restoration Round-Trip Property Tests...\n');
        
        const results = await runLayoutRestorationRoundTripPropertyTest(fc);
        
        // Update summary
        const total = results.passed + results.failed;
        const successRate = total > 0 ? ((results.passed / total) * 100).toFixed(1) : 0;
        
        document.getElementById('totalTests').textContent = total;
        document.getElementById('passedTests').textContent = results.passed;
        document.getElementById('failedTests').textContent = results.failed;
        document.getElementById('successRate').textContent = successRate + '%';
        summaryContainer.style.display = 'block';
        
        if (results.failed === 0) {
          statusDiv.className = 'status success';
          statusDiv.textContent = `‚úÖ All ${results.passed} property tests passed! (${results.passed * 100} total iterations)`;
        } else {
          statusDiv.className = 'status error';
          statusDiv.textContent = `‚ùå ${results.failed} property test(s) failed. See output for details.`;
        }
      } catch (error) {
        console.error('Test execution failed:', error);
        statusDiv.className = 'status error';
        statusDiv.textContent = '‚ùå Test execution failed: ' + error.message;
      } finally {
        runButton.disabled = false;
      }
    }

    function clearOutput() {
      outputDiv.innerHTML = '';
      summaryContainer.style.display = 'none';
      statusDiv.className = 'status info';
      statusDiv.textContent = 'Output cleared. Ready to run tests.';
    }

    runButton.addEventListener('click', runTests);
    clearButton.addEventListener('click', clearOutput);

    // Display ready message
    console.log('Test runner initialized. Click "Run Property Tests" to begin.');
  </script>
</body>
</html>
