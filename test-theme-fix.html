<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Theme System Test</title>
    <style>
        :root {
            /* Light Theme Variables */
            --bg-main: #f8fafc;
            --bg-card: #ffffff;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --accent-gold: #d4af37;
        }

        /* Dark Theme Variables */
        [data-theme="dark"] {
            --bg-main: #0f172a;
            --bg-card: #1e293b;
            --text-primary: #f8fafc;
            --text-secondary: #cbd5e1;
            --accent-gold: #fbbf24;
        }

        body {
            background-color: var(--bg-main);
            color: var(--text-primary);
            font-family: Arial, sans-serif;
            padding: 20px;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .card {
            background: var(--bg-card);
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        button {
            background: var(--accent-gold);
            color: #000;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            margin: 10px;
        }

        .status {
            padding: 10px;
            background: var(--bg-card);
            border-radius: 4px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>Theme System Test</h1>
    
    <div class="card">
        <h2>Current Status</h2>
        <div class="status">
            <p>Current Theme: <span id="currentTheme">loading...</span></p>
            <p>System Preference: <span id="systemTheme">loading...</span></p>
            <p>Saved Theme: <span id="savedTheme">loading...</span></p>
        </div>
        
        <button onclick="toggleTheme()">ðŸŒ™ Toggle Theme</button>
        <button onclick="resetTheme()">ðŸ”„ Reset to System</button>
        <button onclick="testMainGame()">ðŸŽ® Test Main Game</button>
        <button onclick="testPieceSetup()">â™” Test Piece Setup</button>
    </div>

    <div class="card">
        <h2>Theme Test Elements</h2>
        <p>This text should change color based on theme.</p>
        <div class="status">
            <p>This card background should also change.</p>
        </div>
    </div>

    <script>
        // Global theme state
        let currentTheme = 'light';

        // Initialize theme system
        function initThemeSystem() {
            const savedTheme = localStorage.getItem('4x5-chess-theme');
            const systemPrefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
            
            currentTheme = savedTheme || (systemPrefersDark ? 'dark' : 'light');
            
            applyTheme(currentTheme);
            updateDisplay();
            
            console.log('Theme system initialized:', currentTheme);
        }

        // Apply theme to document
        function applyTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            currentTheme = theme;
            
            // Update meta theme-color for mobile browsers
            const themeColorMeta = document.querySelector('meta[name="theme-color"]');
            if (themeColorMeta) {
                themeColorMeta.content = theme === 'dark' ? '#0f172a' : '#ffffff';
            }
        }

        // Toggle theme function
        function toggleTheme() {
            currentTheme = currentTheme === 'light' ? 'dark' : 'light';
            applyTheme(currentTheme);
            saveTheme(currentTheme);
            updateDisplay();
            
            console.log('Theme toggled to:', currentTheme);
        }

        // Save theme to localStorage
        function saveTheme(theme) {
            try {
                localStorage.setItem('4x5-chess-theme', theme);
                localStorage.setItem('pieceSetupTheme', theme);
                console.log('Theme saved:', theme);
            } catch (error) {
                console.warn('Failed to save theme preference:', error);
            }
        }

        // Reset to system theme
        function resetTheme() {
            localStorage.removeItem('4x5-chess-theme');
            localStorage.removeItem('pieceSetupTheme');
            
            const systemPrefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
            currentTheme = systemPrefersDark ? 'dark' : 'light';
            
            applyTheme(currentTheme);
            updateDisplay();
            
            console.log('Theme reset to system:', currentTheme);
        }

        // Update display
        function updateDisplay() {
            document.getElementById('currentTheme').textContent = currentTheme;
            
            const systemPrefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
            document.getElementById('systemTheme').textContent = systemPrefersDark ? 'dark' : 'light';
            
            document.getElementById('savedTheme').textContent = localStorage.getItem('4x5-chess-theme') || 'none';
        }

        // Test main game
        function testMainGame() {
            window.open('index.html', '_blank');
        }

        // Test piece setup
        function testPieceSetup() {
            window.open('piece-setup-working.html', '_blank');
        }

        // Initialize on load
        document.addEventListener('DOMContentLoaded', initThemeSystem);

        // Listen for storage changes
        window.addEventListener('storage', function(e) {
            if (e.key === '4x5-chess-theme') {
                currentTheme = e.newValue || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
                applyTheme(currentTheme);
                updateDisplay();
                console.log('Theme synced from storage:', currentTheme);
            }
        });

        // Auto-update display every 2 seconds
        setInterval(updateDisplay, 2000);
    </script>
</body>
</html>