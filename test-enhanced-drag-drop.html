<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Drag & Drop Test</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/enhanced-drag-drop.css">
    <style>
        body {
            background: #1a1a2e;
            color: white;
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            backdrop-filter: blur(10px);
        }
        
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
        }
        
        .test-palette {
            display: flex;
            gap: 10px;
            margin: 10px 0;
        }
        
        .palette-piece {
            width: 50px;
            height: 50px;
            background: rgba(79, 70, 229, 0.3);
            border: 2px solid rgba(79, 70, 229, 0.5);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            cursor: grab;
            transition: all 0.3s ease;
        }
        
        .test-board {
            display: grid;
            grid-template-columns: repeat(4, 60px);
            grid-template-rows: repeat(5, 60px);
            gap: 2px;
            margin: 20px 0;
            justify-content: center;
        }
        
        .setup-square {
            width: 60px;
            height: 60px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            transition: all 0.3s ease;
        }
        
        .setup-square.light {
            background: rgba(240, 217, 181, 0.3);
        }
        
        .setup-square.dark {
            background: rgba(181, 136, 99, 0.3);
        }
        
        .setup-piece {
            font-size: 1.5rem;
            cursor: grab;
        }
        
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 6px;
            background: rgba(16, 185, 129, 0.2);
            border: 1px solid rgba(16, 185, 129, 0.5);
        }
        
        .error {
            background: rgba(239, 68, 68, 0.2);
            border-color: rgba(239, 68, 68, 0.5);
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üéØ Enhanced Drag & Drop System Test</h1>
        
        <div class="test-section">
            <h2>Test Status</h2>
            <div id="testStatus" class="status">
                Initializing enhanced drag & drop system...
            </div>
        </div>
        
        <div class="test-section">
            <h2>Piece Palette</h2>
            <p>Drag pieces from here to the board below:</p>
            <div class="test-palette">
                <div class="palette-piece" data-piece="K" draggable="true">‚ôî</div>
                <div class="palette-piece" data-piece="Q" draggable="true">‚ôï</div>
                <div class="palette-piece" data-piece="R" draggable="true">‚ôñ</div>
                <div class="palette-piece" data-piece="B" draggable="true">‚ôó</div>
                <div class="palette-piece" data-piece="N" draggable="true">‚ôò</div>
                <div class="palette-piece" data-piece="P" draggable="true">‚ôô</div>
                <div class="palette-piece" data-piece="k" draggable="true">‚ôö</div>
                <div class="palette-piece" data-piece="q" draggable="true">‚ôõ</div>
                <div class="palette-piece" data-piece="r" draggable="true">‚ôú</div>
                <div class="palette-piece" data-piece="b" draggable="true">‚ôù</div>
                <div class="palette-piece" data-piece="n" draggable="true">‚ôû</div>
                <div class="palette-piece" data-piece="p" draggable="true">‚ôü</div>
            </div>
        </div>
        
        <div class="test-section">
            <h2>Test Board (4x5)</h2>
            <p>Drop pieces here. Try invalid moves to test validation:</p>
            <div id="testBoard" class="test-board">
                <!-- Board squares will be generated by JavaScript -->
            </div>
        </div>
        
        <div class="test-section">
            <h2>Test Instructions</h2>
            <ul>
                <li>‚úÖ Drag pieces from palette to board</li>
                <li>‚úÖ Try placing pawns on first/last rank (should be rejected)</li>
                <li>‚úÖ Try placing multiple kings (should be rejected)</li>
                <li>‚úÖ Observe visual feedback during drag operations</li>
                <li>‚úÖ Test click-to-select and place functionality</li>
                <li>‚úÖ Press Escape to cancel drag operations</li>
            </ul>
        </div>
    </div>

    <!-- Include required scripts -->
    <script src="js/translations.js"></script>
    <script src="js/enhanced-ui-manager.js"></script>
    <script src="js/enhanced-drag-drop.js"></script>
    
    <script>
        // Test setup variables
        let setupBoard = [];
        let selectedPalettePiece = null;
        let enhancedUI = null;
        let enhancedDragDrop = null;
        
        // Chess piece symbols
        const TASLAR = {
            'K': '‚ôî', 'Q': '‚ôï', 'R': '‚ôñ', 'B': '‚ôó', 'N': '‚ôò', 'P': '‚ôô',
            'k': '‚ôö', 'q': '‚ôõ', 'r': '‚ôú', 'b': '‚ôù', 'n': '‚ôû', 'p': '‚ôü'
        };
        
        // Helper function to check if piece is white
        function beyazMi(piece) {
            return piece && piece === piece.toUpperCase();
        }
        
        // Translation function (simplified for test)
        function t(key) {
            const translations = {
                'squareOccupied': 'Square is already occupied!',
                'invalidPawnPosition': 'Pawns cannot be placed on this rank!',
                'tooManyPieces': 'Too many pieces of this type!',
                'invalidMove': 'Invalid move!',
                'piecePlaced': 'Piece placed successfully!',
                'pieceDeleted': 'Piece deleted!',
                'dragCancelled': 'Drag operation cancelled'
            };
            return translations[key] || key;
        }
        
        // Initialize test
        function initializeTest() {
            console.log('üß™ Initializing Enhanced Drag & Drop Test...');
            
            // Initialize empty board
            setupBoard = [];
            for (let i = 0; i < 5; i++) {
                setupBoard[i] = [];
                for (let j = 0; j < 4; j++) {
                    setupBoard[i][j] = null;
                }
            }
            
            // Create board squares
            createTestBoard();
            
            // Initialize enhanced systems
            try {
                enhancedUI = new EnhancedPieceSetupUI();
                enhancedDragDrop = new EnhancedDragDropSystem(enhancedUI);
                
                updateStatus('‚úÖ Enhanced drag & drop system initialized successfully!', false);
                console.log('‚ú® Test initialization complete');
            } catch (error) {
                updateStatus('‚ùå Error initializing enhanced drag & drop system: ' + error.message, true);
                console.error('Test initialization failed:', error);
            }
        }
        
        // Create test board
        function createTestBoard() {
            const boardEl = document.getElementById('testBoard');
            boardEl.innerHTML = '';
            
            for (let row = 0; row < 5; row++) {
                for (let col = 0; col < 4; col++) {
                    const square = document.createElement('div');
                    square.className = 'setup-square';
                    square.className += (row + col) % 2 === 0 ? ' light' : ' dark';
                    square.dataset.row = row;
                    square.dataset.col = col;
                    
                    const piece = setupBoard[row][col];
                    if (piece) {
                        const pieceEl = document.createElement('div');
                        pieceEl.className = 'setup-piece';
                        pieceEl.textContent = TASLAR[piece];
                        pieceEl.draggable = true;
                        pieceEl.dataset.piece = piece;
                        square.appendChild(pieceEl);
                    }
                    
                    boardEl.appendChild(square);
                }
            }
        }
        
        // Redraw board (called by enhanced drag & drop system)
        function drawSetupBoard() {
            createTestBoard();
        }
        
        // Update test status
        function updateStatus(message, isError = false) {
            const statusEl = document.getElementById('testStatus');
            statusEl.textContent = message;
            statusEl.className = isError ? 'status error' : 'status';
        }
        
        // Initialize test when page loads
        document.addEventListener('DOMContentLoaded', initializeTest);
        
        // Add some test logging
        document.addEventListener('dragstart', (e) => {
            console.log('üéØ Test: Drag started -', e.target.dataset.piece);
        });
        
        document.addEventListener('drop', (e) => {
            console.log('üéØ Test: Drop event -', e.target.dataset.row, e.target.dataset.col);
        });
        
        document.addEventListener('dragend', (e) => {
            console.log('üéØ Test: Drag ended');
        });
    </script>
</body>
</html>